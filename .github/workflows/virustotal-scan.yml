name: VirusTotal Scan

on:
  release:
    types: [published]
  workflow_dispatch:
    inputs:
      tag:
        description: 'Release tag to scan (e.g. v2.6.256)'
        required: true

permissions:
  contents: write  # Required for updating release body

jobs:
  virustotal:
    runs-on: ubuntu-latest
    steps:
      - name: Download release assets
        uses: robinraju/release-downloader@v1
        with:
          tag: ${{ github.event.release.tag_name || github.event.inputs.tag }}
          fileName: '*'
          out-file-path: assets

      - name: VirusTotal Scan
        uses: crazy-max/ghaction-virustotal@v4
        with:
          vt_api_key: ${{ secrets.VT_API_KEY }}
          update_release_body: true
          github_token: ${{ secrets.GITHUB_TOKEN }}
          files: |
            assets/MedicalAssistant
            assets/MedicalAssistant.exe
            assets/MedicalAssistant-macOS.dmg
